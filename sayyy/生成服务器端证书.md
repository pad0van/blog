#安卓APK签名

为防止误操作，强烈建议 keypass 和 storepass 密码保持一致。



##1.生成KeyPair
说明：

> -genkey [产生密钥对]
> -dname [别名相关附加信息,其中cn是服务器的名字一定要与WEB服务器中设置的一样]
> -alias [密钥对别名]
> -validity [密钥有效期]
> -keyalg [密钥算法参数]
> -keysize [密钥位数]
> -keypass [密钥保护密码]
> -storepass [存储密码]
> -keystore [密钥存储文件路径]

```shell
keytool -genkey \
    -dname "CN=app.shgjj.com, OU=SHGJJ, O=SHGJJ, L=Xuhui, ST=Shanghai, C=CN" \
    -alias shgjj-app \
    -validity 1000 \
    -keyalg RSA \
    -keysize 4096 \
    -keypass openssl \
    -storepass openssl \
    -keystore app.jks
```



##2.生成待签名证书

说明：输出 server.csr

> -certreq [产生待签名证书]
> -alias [证书别名]
> -sigalg [证书算法参数]
> -file [产生文件输出路径]
> -keypass [密钥保护密码]
> -keystore [存储文件路径]
> -storepass [存储密码]

```shell
keytool -certreq \
    -alias shgjj-app \
    -sigalg SHA256withRSA \
    -file server.csr \
    -keypass openssl \
    -storepass openssl \
    -keystore app.jks
```



##3.用CA私钥进行签名, 产生x509证书文件
说明：输出 server-cert.pem

> x509 [签发x509证书命令]
> -req [输入待签发证书]
> -in [输入待签发证书文件路径]
> -out [产生x509证书文件输出路径]
> -CA [签发根证书]
> -CAkey [根证书密钥文件]
> -days [证书有效期]
> -CAserial [CA序列号文件]

```shell
openssl x509 -req \
    -in server.csr \
    -out server-cert.pem \
    -CA ca-cert.pem \
    -CAkey ca-key.pem \
    -CAserial ca-cert.srl \
    -days 1000 \
    -sha1 \
    -trustout
```



##4.把CA根证书导入keystore
说明：

> -import [导入命令]
> -v [显示详情]
> -trustcacerts [导入信任证书]
> -storepass [存储密码]
> -keypass [密钥保护密码]
> -alias [服务器证书的别名]
> -file [证书文件路径]
> -keystore [导入文件路径]
> -noprompt [不提示"您仍然想要将它添加到自己的keystore 吗？"]

```shell
keytool -import -v \
    -trustcacerts \
    -storepass openssl \
    -keypass openssl \
    -alias shgjj-root \
    -file ca-cert.pem \
    -keystore app.jks \
    -noprompt
```



##5.把CA签名后的server端证书导入keystore
说明：

> -import [导入命令]
> -v [显示详情]
> -trustcacerts [导入信任证书]
> -storepass [存储密码]
> -keypass [密钥保护密码]
> -alias [服务器证书的别名]
> -file [证书文件路径]
> -keystore [导入文件路径]

```shell
keytool -import -v \
    -trustcacerts \
    -storepass openssl \
    -keypass openssl \
    -alias shgjj-app \
    -file server-cert.pem \
    -keystore app.jks
```



##6.查看server端证书
```shell
keytool -list -storepass openssl -keystore app.jks -v
```



## 7.签名Andoid程序apk

```shell
jarsigner -verbose -keystore shgjj.keystore -signedjar shgjj_v2_signed.apk shgjj_v2.apk shgjj_keystore

zipalign -v 4 shgjj_v2_signed.apk shgjj_v2_signed_aligned.apk
```

